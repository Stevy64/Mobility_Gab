{% extends 'core/dashboard/base.html' %}

{% block dashboard_title %}Bienvenue, {{ user.first_name|default:user.email }}{% endblock %}
{% block dashboard_subtitle %}Suivez vos abonnements et trajets en cours.{% endblock %}

{% block dashboard_actions %}
<div class="btn-group" role="group">
    <a href="{% url 'subscriptions:ride_request_advanced' %}" class="btn btn-primary">
        <i class="bi bi-plus-circle"></i> Nouvelle course
    </a>
    <a href="{% url 'subscriptions:trip_history' %}" class="btn btn-outline-secondary">
        <i class="bi bi-clock-history"></i> Historique
    </a>
    <a href="#" class="btn btn-success" onclick="triggerSOS()">
        <i class="bi bi-shield-exclamation"></i> SOS
    </a>
</div>
{% endblock %}

{% block dashboard_content %}
<div class="row g-4">
    <div class="col-md-4">
        <div class="card card-kpi shadow-sm border-0 p-3 h-100">
            <div class="d-flex align-items-center">
                <div class="bg-primary bg-opacity-10 text-primary rounded-circle p-3">
                    <i class="bi bi-calendar-check fs-4"></i>
                </div>
                <div class="ms-3">
                    <p class="text-muted small mb-1">Abonnements actifs</p>
                    <h3 class="mb-0">{{ active_subscriptions|default:0 }}</h3>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card card-kpi shadow-sm border-0 p-3 h-100">
            <div class="d-flex align-items-center">
                <div class="bg-success bg-opacity-10 text-success rounded-circle p-3">
                    <i class="bi bi-geo-alt fs-4"></i>
                </div>
                <div class="ms-3">
                    <p class="text-muted small mb-1">Trajet en cours</p>
                    <h3 class="mb-0">{{ current_trip|default:"Aucun" }}</h3>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card card-kpi shadow-sm border-0 p-3 h-100">
            <div class="d-flex align-items-center">
                <div class="bg-warning bg-opacity-10 text-warning rounded-circle p-3">
                    <i class="bi bi-wallet fs-4"></i>
                </div>
                <div class="ms-3">
                    <p class="text-muted small mb-1">Prochain paiement</p>
                    <h3 class="mb-0">{{ next_due_date|date:"d/m/Y"|default:"-" }}</h3>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row g-4 mt-1">
    <div class="col-lg-7">
        <div class="card shadow-sm border-0">
            <div class="card-body">
                <h5 class="fw-bold d-flex justify-content-between align-items-center">
                    Suivi temps réel
                    <a href="#" class="btn btn-outline-secondary btn-sm">Partager</a>
                </h5>
                <div class="ratio ratio-16x9 bg-light rounded-3" id="live-map">
                    <iframe src="https://maps.google.com/maps?q=Libreville&t=&z=13&ie=UTF8&iwloc=&output=embed" title="Carte" class="rounded-3 border-0"></iframe>
                </div>
                <div class="mt-3">
                    <h6 class="fw-semibold">Derniers checkpoints</h6>
                    <ul class="list-group list-group-flush" id="checkpoint-feed">
                        <li class="list-group-item small text-muted">En route • 07:15</li>
                        <li class="list-group-item small text-muted">Arrivé au domicile • 07:25</li>
                        <li class="list-group-item small text-muted">Enfant récupéré • 07:30</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-5">
        <div class="card shadow-sm border-0 mb-4">
            <div class="card-body">
                <h5 class="fw-bold">Paiements récents</h5>
                <ul class="list-group list-group-flush small">
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        28 Sept • 50 000 FCFA
                        <span class="badge bg-success rounded-pill">Payé</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        28 Août • 50 000 FCFA
                        <span class="badge bg-success rounded-pill">Payé</span>
                    </li>
                </ul>
            </div>
        </div>
        <div class="card shadow-sm border-0">
            <div class="card-body">
                <h5 class="fw-bold">Notifications</h5>
                <ul class="list-group list-group-flush small" id="notification-feed">
                    <li class="list-group-item">
                        <span class="fw-semibold">Chauffeur en route</span>
                        <div class="text-muted">Aujourd'hui • 07:15</div>
                    </li>
                    <li class="list-group-item">
                        <span class="fw-semibold">Paiement reçu</span>
                        <div class="text-muted">Hier • 12:30</div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}


